# Called by itemflexer:display/load

data remove storage ifl:storage item
data remove storage ifl:storage name1
data remove storage ifl:storage name0
data remove storage ifl:storage name

data modify storage ifl:storage item set from entity @s SelectedItem

# Armor stand for checking stuff with predicates
summon minecraft:armor_stand ~ ~ ~ {Invisible:1b,Marker:1b,Tags:["ifl","ifl.temp_item_holder","global.ignore"],ArmorItems:[{id:"minecraft:nether_star",Count:1b}]}
data modify entity @e[type=minecraft:armor_stand,tag=ifl.temp_item_holder,sort=nearest,limit=1] ArmorItems[0] set from storage ifl:storage item

# Get the item's name
data modify storage ifl:storage name0 set from storage ifl:storage item.tag.display.Name
execute if data storage ifl:storage item{id:"minecraft:written_book"} if data storage ifl:storage item.tag.title run data modify storage ifl:storage name0 set value '{"nbt":"item.tag.title","storage":"ifl:storage"}'
execute unless data storage ifl:storage name0 run function itemflexer:display/get_default_name
data modify storage ifl:storage name1 set from storage ifl:storage name0
execute unless data storage ifl:storage item.tag.tcc unless data storage ifl:storage item.tag.ctc as @e[type=minecraft:armor_stand,tag=ifl.temp_item_holder,sort=nearest,limit=1] run function itemflexer:display/get_rarity

# Italicize it if renamed (with some false negatives :P)
data modify storage ifl:storage name set from storage ifl:storage name1
execute unless data storage ifl:storage item.tag.tcc unless data storage ifl:storage item.tag.ctc if data storage ifl:storage item.tag.display.Name run data modify storage ifl:storage name set value '["",{"nbt":"name1","storage":"ifl:storage","interpret":true,"italic":true}]'

scoreboard players set #current_lore_length ifl.dummy -1
scoreboard players set #temp3 ifl.dummy 0

data modify storage ifl:storage lore set value ["","","","","","","","","","","","","","","",""]

data modify storage ifl:storage lore_add set from storage ifl:storage name
function itemflexer:display/get_lore/add

# Lore
function itemflexer:display/get_lore/all

# Display name + all lore length variations
execute if score #current_lore_length ifl.dummy matches -1 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true}, "]"]
execute if score #current_lore_length ifl.dummy matches 0 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 1 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 2 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 3 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 4 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 5 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 6 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 7 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 8 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[8]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 9 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[8]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[9]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 10 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[8]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[9]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[10]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 11 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[8]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[9]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[10]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[11]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 12 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[8]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[9]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[10]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[11]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[12]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 13 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[8]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[9]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[10]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[11]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[12]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[13]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 14 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[8]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[9]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[10]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[11]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[12]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[13]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[14]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 15 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[8]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[9]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[10]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[11]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[12]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[13]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[14]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[15]","storage":"ifl:storage","interpret":true}]}}, "]"]
execute if score #current_lore_length ifl.dummy matches 16 run tellraw @a ["<",{"selector":"@s"},"> [",{"nbt":"name", "storage":"ifl:storage", "interpret": true, "hoverEvent": {"action":"show_text", "contents": [{"nbt":"lore[0]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[1]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[2]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[3]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[4]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[5]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[6]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[7]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[8]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[9]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[10]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[11]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[12]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[13]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[14]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[15]","storage":"ifl:storage","interpret":true},"\n",{"nbt":"lore[16]","storage":"ifl:storage","interpret":true}]}}, "]"]

kill @e[type=minecraft:item,tag=ifl.temp_item,sort=nearest,limit=1]
kill @e[type=minecraft:armor_stand,tag=ifl.temp_item_holder,sort=nearest,limit=1]
